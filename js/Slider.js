function DataStream(timeout,outputLocation){this.TIME=timeout;this.outputLocation=outputLocation;this.outputVar="";this.timeout=null;this.isStreamActive=!1;this.startStream=function(){this.isStreamActive=!0;this.stream()};this.stream=function(){var thisStream=this;if(this.isStreamActive){this.timeout=setTimeout(function(){jQuery.get(thisStream.outputLocation+thisStream.outputVar,function(data){thisStream.stream()})},this.TIME)}};this.endStream=function(){this.isStreamActive=!1;window.clearTimeout(this.timeout)}};function Slider(){this.sliderStream=new DataStream(150,"cs/chan/wheel/");this.loadSlider=function(){this.centerSlider();$('#clear-button').attr("data-content","<button id='clear-all' class='btn btn-primary'>All</button><button id='clear-playbacks' class='btn btn-primary'>Play<br />backs</button><button id='clear-cues' class='btn btn-primary'>Cues</button><button id='clear-channels' class='btn btn-primary'>Chan<br />nels</button><button id='clear-selection' class='btn btn-primary'>Selec<br />tion</button>");$('#clear-button').popover();var bar=document.getElementById('bar');bar.addEventListener('mousedown',this.startSlide,!1);bar.addEventListener('touchstart',this.startSlide,!1);$("body").on('mousemove touchmove',this.moveSlide);$("body").on("mouseup touchend",this.stopSlide);$(window).on('resize',this.centerSlider)};this.centerSlider=function(){var height=$(".slider").height();$(".slider").css("margin","-"+Math.round(height/2)+"px 0 0 0")};this.startSlide=function(event){if($("#slider").attr("data-moving").valueOf()==="false"){$("#slider").attr("data-moving","true");slider.sliderStream.startStream();var coords=pointerEventToXY(event);var innerY=coords.y;var sliderMid=$("#slider").offset().top+$("#slider").height()/2;var separation=Math.abs(sliderMid-innerY);if(separation>($("#slider").height()/2)){slider.moveSlide(event)}}};this.moveSlide=function(event){if($("#slider").attr("data-moving")!==undefined){if($("#slider").attr("data-moving").valueOf()==="true"){var coords=pointerEventToXY(event);var innerY=coords.y-$("#bar").offset().top;if(innerY<0){innerY=0}else if(innerY>$("#bar").height()){innerY=$("#bar").height()}
var Ypos=innerY*80/$("#bar").height();var Ypos=Ypos+10;$("#slider").css("top",Ypos+"%");var neutral=$("#bar").offset().top+$("#bar").height()/2;var sliderMid=$("#slider").offset().top+$("#slider").height()/2;var rawVal=neutral-sliderMid;if(rawVal!==0){var isPos=(rawVal>0);rawVal=Math.abs(rawVal);var maxPossible=100;var sendVal=rawVal*maxPossible/(($("#bar").height()/2)-($("#slider").height()/2));sendVal=Math.round(sendVal);slider.sliderStream.outputVar=(isPos)?"+"+sendVal:"-"+sendVal}}}};this.stopSlide=function(){slider.sliderStream.endStream();if($("#slider").attr("data-moving")!==undefined){if($("#slider").attr("data-moving").valueOf()==="true"){slider.sliderStream.outputVar="0";$("#slider").css("top","50%");$("#slider").attr("data-moving","false")}}}};slider=new Slider();function ColorPicker(){this.colorStream=new DataStream(150,"cs/color/hs/");this.loadColorPicker=function(){var bar=document.getElementById('bar');$('#view').on('dragstart',"#color-picker img",function(event){event.preventDefault()});$("#view").on('mousedown touchstart','#color-picker img',this.startTouch);$("#view").on('mousemove touchmove',this.moveTouch);$("body").on("mouseup touchend",this.stopTouch)};this.calculateHueSat=function(coords){var parent=$("#color-picker img");var hueSat={hue:0,sat:0};var innerX=coords.x-parent.offset().left;var innerY=coords.y-parent.offset().top;var width=parent.width();var height=parent.height();hueSat.hue=Math.round(innerX*359/width);hueSat.sat=Math.round((height-innerY)*100/height);return hueSat};this.startTouch=function(event){if($("#color-picker img").attr("data-touched").valueOf()==="false"){$("#color-picker img").attr("data-touched","true");var hueSat=colorPicker.calculateHueSat(pointerEventToXY(event));colorPicker.colorStream.outputVar=hueSat.hue+"/"+hueSat.sat;colorPicker.colorStream.startStream()}};this.moveTouch=function(event){if($("#color-picker img").attr("data-touched")!==undefined){if($("#color-picker img").attr("data-touched").valueOf()==="true"){var hueSat=colorPicker.calculateHueSat(pointerEventToXY(event));colorPicker.colorStream.outputVar=hueSat.hue+"/"+hueSat.sat}}};this.stopTouch=function(){colorPicker.colorStream.endStream();if($("#color-picker img").attr("data-touched")!==undefined){if($("#color-picker img").attr("data-touched").valueOf()==="true"){$("#color-picker img").attr("data-touched","false")}}}};var pointerEventToXY=function(e){var out={x:0,y:0};if(e.type=='touchstart'||e.type=='touchmove'||e.type=='touchend'||e.type=='touchcancel'){var touch;if(e.originalEvent!==undefined){touch=e.originalEvent.touches[0]}else{touch=e.touches[0]}
out.x=touch.pageX;out.y=touch.pageY}else if(e.type=='mousedown'||e.type=='mouseup'||e.type=='mousemove'||e.type=='mouseover'||e.type=='mouseout'||e.type=='mouseenter'||e.type=='mouseleave'){out.x=e.pageX;out.y=e.pageY}
return out}