var Views={patchView:null,playbackView:null,cueView:null,sequenceView:null,channelView:null,parameterView:null,helpView:null,levelColorView:null,dmxuView:null,mastersView:null,panTiltView:null,groupView:null,soloChannelView:null};var viewConstants={viewIDs:{PATCH_VIEW_ID:0,PLAYBACK_VIEW_ID:1,CUE_VIEW_ID:2,SEQUENCE_VIEW_ID:3,CHANNEL_VIEW_ID:4,PARAMETER_VIEW_ID:5,HELP_VIEW_ID:6,LEVEL_COLOR_VIEW_ID:7,DMXU_VIEW_ID:8,MASTER_VIEW_ID:9,PAN_TILT_VIEW_ID:10,GROUP_VIEW_ID:11,SOLO_CHANNEL_VIEW_ID:12},commandURLs:{patchDATA:"/cs/get/patch",playbackDATA:"/cs/get/playbacks",cueDATA:"/cs/get/cueList",seqDATA:"/cs/get/sequence/",channelDATA:"/cs/get/channels",parameterDATA:"/cs/get/parameters",helpDATA:"/help/current",colorDATA:"/cs/get/colorChips",chipsDATA:"/cs/get/colorChips",dmxuDATA:"/cs/get/outputs/",groupDATA:{location:"/cs/get/locationGroups",tag:"/cs/get/tagGroups"},globalDATA:"/cs/get/status"}};function View(viewID,dataURL,doesRefresh){this.url=dataURL;this.refreshEnabled=doesRefresh;this.id=viewID;this.timeout=null;this.REFRESH_TIME=100;this.variables=""};View.prototype={constructor:View,insertHTML:function(data){},generateHTML:function(data){},draw:function(){var thisView=this;jQuery.getJSON(this.url,function(data){thisView.insertHTML(data)})},show:function(){var thisView=this;jQuery.getJSON(this.url,function(data){thisView.generateHTML(data);if(thisView.refreshEnabled){thisView.poll()}else{thisView.draw()}})},hide:function(){this.stop()},poll:function(){var thisView=this;this.timeout=setTimeout(function(){if(ViewManager.isViewActive(thisView)){jQuery.getJSON(thisView.url+thisView.variables,function(data){thisView.insertHTML(data);thisView.poll()})}},this.REFRESH_TIME)},stop:function(){window.clearTimeout(this.timeout)},};var ViewManager={activeViews:new Array(),add:function(view){view.show();this.activeViews.push(view)},hideAll:function(){for(var i=0;i<this.activeViews.length;i++){this.activeViews[i].hide()}
this.activeViews=new Array()},stopRefresh:function(){for(var i=0;i<this.activeViews.length;i++){this.activeViews[i].stop()}},restartRefresh:function(){for(var i=0;i<this.activeViews.length;i++){this.activeViews[i].poll()}},isViewActive:function(view){var isActive=!1;for(var i=0;i<this.activeViews.length;i++){if(this.activeViews[i].id===view.id){isActive=!0;break}}
return isActive},refreshActiveViews:function(){for(var i=0;i<this.activeViews.length;i++){this.activeViews[i].hide();this.activeViews[i].show()}}};var var_subView="#subView";var var_view="#view";var var_sequenceModal="#sequenceView .modal-body";function loadSingletonView(){$("#view-container").removeClass("view-top-dual");$("#view-container").addClass("view-singleton");$(var_subView).hide()}
function loadDualView(){$("#view-container").removeClass("view-singleton");$("#view-container").addClass("view-top-dual");$(var_subView).show()}
function initialiseAllViews(){Views.channelView=new View(viewConstants.viewIDs.CHANNEL_VIEW_ID,viewConstants.commandURLs.channelDATA,!0);Views.channelView.variables="?ifChanged=true";Views.channelView.zoomed=!1;Views.channelView.insertHTML=function(data){thisView=this;if(data.channels!==undefined){$.each(data.channels,function(i,channel){$("div[data-channel='"+(channel.channel+1)+"']").css("background-color",thisView.getRGBAValues(channel));$("div[data-channel='"+(channel.channel+1)+"'] span").css("color",((channel.level>127)?"black":"white"));if(channel.selected){$("div[data-channel='"+(channel.channel+1)+"']").css("border-color","#008800");$("div[data-channel='"+(channel.channel+1)+"']").removeClass("notSelected");$("div[data-channel='"+(channel.channel+1)+"']").addClass("isSelected")}else{$("div[data-channel='"+(channel.channel+1)+"']").css("border-color","#333333");$("div[data-channel='"+(channel.channel+1)+"']").removeClass("isSelected");$("div[data-channel='"+(channel.channel+1)+"']").addClass("notSelected")}})}};Views.channelView.generateHTML=function(data){thisView=this;jQuery.getJSON(viewConstants.commandURLs.patchDATA,function(topoData){var gridRows=8;var gridCols=16;var startX=0;var startY=0;var endX=15;var endY=7;if(thisView.zoomed){var lowestX,lowestY,highestX,highestY;lowestX=16;highestX=0;lowestY=8;highestY=0;for(var i=0;i<8;i++){for(var j=0;j<16;j++){var topoCell=topoData.topo[(i*16)+j];if(topoCell.channel!=-1){if(j>highestX){highestX=j}
if(j<lowestX){lowestX=j}
if(i>highestY){highestY=i}
if(i<lowestY){lowestY=i}}}}
startX=lowestX;startY=lowestY;endX=highestX;endY=highestY;gridCols=highestX-lowestX+1;gridRows=highestY-lowestY+1}
var generatedHtml="<div id=\"channels\" class=\"grid\">";for(var i=0;i<8;i++){if(i>=startY&&i<=endY){generatedHtml+="<div class='grid-row' style='height:"+(100/gridRows)+"%'>";for(var j=0;j<16;j++){if(j>=startX&&j<=endX){topoCell=topoData.topo[(i*16)+j];if(topoCell.channel!=-1){var channel;for(var k=0;k<+data.channels.length;k++){if(data.channels[k].channel===topoCell.channel){channel=data.channels[k];break}}
generatedHtml+="<div class='grid-cell noSelect "+((channel.selected)?"isSelected":"notSelected")+"' data-type='chan-color' data-channel='"+(topoCell.channel+1)+"' ";generatedHtml+="style='width:"+(100/gridCols)+"%;background-color:"+thisView.getRGBAValues(channel)+((channel.selected)?";border-color:#080'":";border-color:#333'");generatedHtml+=">";generatedHtml+="<span data-type=\"chan-num\" "+((channel.level>127)?"style='color:black'":"style='color:white'")+">"+(topoCell.channel+1)+"</span>";generatedHtml+="</div>"}else{generatedHtml+="<div class='grid-cell empty-cell' style='width:"+(100/gridCols)+"%'></div>"}}}
generatedHtml+="</div>"}}
generatedHtml+="</div>"+"<div class='grid-side-bar'>"+"<div id='grid-zoom' class='grid-side-bar-button' data-toggle='tooltip' data-placement='left' title='Zoom'><img src='img/zoom.png' /></div>"+"<div class='grid-side-bar-seperator'></div>"+"<div id='grid-select-all' class='grid-side-bar-button' data-toggle='tooltip' data-placement='left' title='Select All'><img src='img/select-all.png' /></div>"+"<div class='grid-side-bar-seperator'></div>"+"<div id='grid-deselect-all' class='grid-side-bar-button' data-toggle='tooltip' data-placement='left' title='Unselect All'><img src='img/deselect-all.png' /></div>"+"</div>";$(var_subView).html(generatedHtml);$("#subView .grid").css("width",($("#subView").width()-$("#subView .grid-side-bar").width()))});$("#channels").load(function(){thisView.draw()})};Views.channelView.getRGBAValues=function(channel){var generatedHtml="rgba(";generatedHtml+=channel.r+",";generatedHtml+=channel.g+",";generatedHtml+=channel.b+",";generatedHtml+=(channel.level/254)+")";return generatedHtml};Views.soloChannelView=new View(viewConstants.viewIDs.SOLO_CHANNEL_VIEW_ID,viewConstants.commandURLs.channelDATA,!0);Views.soloChannelView.variables="?ifChanged=true";Views.soloChannelView.zoomed=!1;Views.soloChannelView.insertHTML=function(data){thisView=this;if(data.channels!==undefined){$.each(data.channels,function(i,channel){$("div[data-channel='"+(channel.channel+1)+"']").css("background-color",thisView.getRGBAValues(channel));$("div[data-channel='"+(channel.channel+1)+"'] span").css("color",((channel.level>127)?"black":"white"));if(channel.selected){$("div[data-channel='"+(channel.channel+1)+"']").css("border-color","#008800");$("div[data-channel='"+(channel.channel+1)+"']").removeClass("notSelected");$("div[data-channel='"+(channel.channel+1)+"']").addClass("isSelected")}else{$("div[data-channel='"+(channel.channel+1)+"']").css("border-color","#333333");$("div[data-channel='"+(channel.channel+1)+"']").removeClass("isSelected");$("div[data-channel='"+(channel.channel+1)+"']").addClass("notSelected")}})}};Views.soloChannelView.generateHTML=function(data){$(var_view).html("");loadSingletonView();thisView=this;jQuery.getJSON(viewConstants.commandURLs.patchDATA,function(topoData){var gridRows=8;var gridCols=16;var startX=0;var startY=0;var endX=15;var endY=7;if(thisView.zoomed){var lowestX,lowestY,highestX,highestY;lowestX=16;highestX=0;lowestY=8;highestY=0;for(var i=0;i<8;i++){for(var j=0;j<16;j++){var topoCell=topoData.topo[(i*16)+j];if(topoCell.channel!=-1){if(j>highestX){highestX=j}
if(j<lowestX){lowestX=j}
if(i>highestY){highestY=i}
if(i<lowestY){lowestY=i}}}}
startX=lowestX;startY=lowestY;endX=highestX;endY=highestY;gridCols=highestX-lowestX+1;gridRows=highestY-lowestY+1}
var generatedHtml=""+"<div class='level-control noSelect'>"+"<div class='top level-head-foot-button'>"+"<button class='btn btn-primary blank'></button>"+"</div>"+"<div id='level-toggle' data-state='bar'><img src='img/arrow-up.png' /></div>"+"<div class='level-switcher'><div id='level-buttons' class='level-buttons'>"+"<button id='setToFull' class='btn btn-primary'>Full</button>"+"<button id='addTen' class='btn btn-primary'>+10</button>"+"<button id='addOne' class='btn btn-primary'>+1</button>"+"<button id='subOne' class='btn btn-primary'>-1</button>"+"<button id='subTen' class='btn btn-primary'>-10</button>"+"<button id='setToZero' class='btn btn-primary'>Off</button>"+"</div>"+"<div id='bar' class='slider-bar noSelect'>"+"<div class='slider-background'></div>"+"<div id='slider' class='slider' data-moving='false'><p>Level</p></div>"+"</div>"+"</div>"+"<div class='bottom level-head-foot-button'>"+"<button id='clear-button' type='button' class='btn btn-primary' data-trigger='focus' data-html='true' data-toggle='popover' data-placement='left'>Clear</button>"+"</div>"+"</div>";generatedHtml+="<div class='solo-channels'><div id=\"channels\" class=\"grid\">";for(var i=0;i<8;i++){if(i>=startY&&i<=endY){generatedHtml+="<div class='grid-row' style='height:"+(100/gridRows)+"%'>";for(var j=0;j<16;j++){if(j>=startX&&j<=endX){topoCell=topoData.topo[(i*16)+j];if(topoCell.channel!=-1){var channel;for(var k=0;k<+data.channels.length;k++){if(data.channels[k].channel===topoCell.channel){channel=data.channels[k];break}}
generatedHtml+="<div class='grid-cell noSelect "+((channel.selected)?"isSelected":"notSelected")+"' data-type='chan-color' data-channel='"+(topoCell.channel+1)+"' ";generatedHtml+="style='width:"+(100/gridCols)+"%;background-color:"+thisView.getRGBAValues(channel)+((channel.selected)?";border-color:#080'":";border-color:#333'");generatedHtml+=">";generatedHtml+="<span data-type=\"chan-num\" "+((channel.level>127)?"style='color:black'":"style='color:white'")+">"+(topoCell.channel+1)+"</span>";generatedHtml+="</div>"}else{generatedHtml+="<div class='grid-cell empty-cell' style='width:"+(100/gridCols)+"%'></div>"}}}
generatedHtml+="</div>"}}
generatedHtml+="</div>"+"<div class='grid-side-bar'>"+"<div id='grid-zoom' class='grid-side-bar-button' data-toggle='tooltip' data-placement='left' title='Zoom'><img src='img/zoom.png' /></div>"+"<div class='grid-side-bar-seperator'></div>"+"<div id='grid-select-all' class='grid-side-bar-button' data-toggle='tooltip' data-placement='left' title='Select All'><img src='img/select-all.png' /></div>"+"<div class='grid-side-bar-seperator'></div>"+"<div id='grid-deselect-all' class='grid-side-bar-button' data-toggle='tooltip' data-placement='left' title='Unselect All'><img src='img/deselect-all.png' /></div>"+"</div></div>";$(var_view).html(generatedHtml);$("#view .grid").css("width",($(".solo-channels").width()-$("#view .grid-side-bar").width()));$('#level-buttons').hide();slider.loadSlider()});$("#channels").load(function(){thisView.draw()})};Views.soloChannelView.getRGBAValues=function(channel){var generatedHtml="rgba(";generatedHtml+=channel.r+",";generatedHtml+=channel.g+",";generatedHtml+=channel.b+",";generatedHtml+=(channel.level/254)+")";return generatedHtml};Views.levelColorView=new View(viewConstants.viewIDs.LEVEL_COLOR_VIEW_ID,viewConstants.commandURLs.colorDATA,!1);Views.levelColorView.generateHTML=function(data){loadDualView();var thisView=this;jQuery.getJSON(viewConstants.commandURLs.chipsDATA,function(data){var generatedHtml=""+"<div class='level-control noSelect'>"+"<div class='top level-head-foot-button'>"+"<button id='chips-button' class='btn btn-primary'>Chips</button>"+"<button id='picker-button' class='btn btn-primary'>Picker</button>"+"</div>"+"<div id='level-toggle' data-state='bar'><img src='img/arrow-up.png' /></div>"+"<div class='level-switcher'><div id='level-buttons' class='level-buttons'>"+"<button id='setToFull' class='btn btn-primary'>Full</button>"+"<button id='addTen' class='btn btn-primary'>+10</button>"+"<button id='addOne' class='btn btn-primary'>+1</button>"+"<button id='subOne' class='btn btn-primary'>-1</button>"+"<button id='subTen' class='btn btn-primary'>-10</button>"+"<button id='setToZero' class='btn btn-primary'>Off</button>"+"</div>"+"<div id='bar' class='slider-bar noSelect'>"+"<div class='slider-background'></div>"+"<div id='slider' class='slider' data-moving='false'><p>Level</p></div>"+"</div>"+"</div>"+"<div class='bottom level-head-foot-button'>"+"<button id='clear-button' type='button' class='btn btn-primary' data-trigger='focus' data-html='true' data-toggle='popover' data-placement='left'>Clear</button>"+"</div>"+"</div>"+"<div id='color-picker' class='noSelect color-content'>"+"<form name='pointform' method='post'><img data-touched='false' src='img/hue-sat.png'></form>"+"</div>"+"<div id='color-chips' class='noSelect color-content'>";generatedHtml+="<div class='chip-holder'>";for(var i=0;i<data.colorChips.length;i++){var chip=data.colorChips[i];if(chip.r!=0||chip.g!=0||chip.b!=0){generatedHtml+="<div data-chip='"+chip.chip+"' class='chip' style='background-color:"+thisView.getRGBValues(chip)+"'></div>"}}
generatedHtml+="</div></div>";$(var_view).html(generatedHtml);$('#picker-button').hide();$('#color-chips').hide();$('#level-buttons').hide();slider.loadSlider()})};Views.levelColorView.getRGBValues=function(obj){var generatedHtml="rgb(";generatedHtml+=obj.r+",";generatedHtml+=obj.g+",";generatedHtml+=obj.b+")";return generatedHtml};Views.mastersView=new View(viewConstants.viewIDs.MASTER_VIEW_ID,viewConstants.commandURLs.playbackDATA,!0);Views.mastersView.insertHTML=function(data){$("#playback-page-num p").html(data.playbackPage);if((data.playbackPage-1)!=this.pageNum){this.pageNum=(data.playbackPage-1);this.updateFaders()}
$.each(data.playbacks,function(i,playback){var bump=$("*[data-number='"+i+"']").find(".fader-bump");if(playback.contentType.valueOf()==="Mem"){$(bump).addClass("memory");$(bump).removeClass("sequence")}else if(playback.contentType.valueOf()==="Seq"){$(bump).addClass("sequence");$(bump).removeClass("memory")}else{$(bump).removeClass("memory");$(bump).removeClass("sequence")}})};Views.mastersView.generateHTML=function(data){loadDualView();this.pageNum=(data.playbackPage-1);var size=data.playbacks.length;var generatedHTML="<div class='fader-container'><div class='fader-list noSelect' data-type='channels' style='width:"+(55*size)+"px'>";for(var i=0;i<size;i++){generatedHTML+="<div class='fader' data-number='"+i+"'><div class='fader-control'><div class='fader-background'></div><div class='fader-slider-move-space'><div class='fader-slider' data-level='0'></div></div></div><div class='fader-bump'><button class='btn btn-primary' data-number='"+i+"'>"+(i+1)+"</button></div></div>"}
generatedHTML+="</div></div>";var footerHTML="<div class='fader-sub-bar channels'><div class='sub-bar-control divider'></div><button id='fader-channels-btn' class='btn btn-primary mode-switch-button sub-bar-control'>Channels</button><div class='sub-bar-control divider'></div><button id='fader-playback-btn' class='btn btn-primary mode-switch-button sub-bar-control'>Playbacks</button><div class='sub-bar-control divider'></div><div class='sub-bar-control left message'>Channels</div></div>";var footerHtml="<div class='capsule-nav-container'><div class='capsule-nav noSelect'><span>Page:</span>"+"<div id='playback-page-plus' class='capsule-nav-cell change-page'><p>+</p></div>"+"<div id='playback-page-num' class='capsule-nav-cell'><p>"+data.playbackPage+"</p></div>"+"<div id='playback-page-minus' class='capsule-nav-cell change-page'><p>-</p></div></div></div>";$(var_view).html(generatedHTML);$("#view-footer").html(footerHtml);this.updateFaders();$('#view .fader-container').mousewheel(function(event,delta){this.scrollLeft-=(delta*30);event.preventDefault()});$("#view .fader-list").css("height",($("#view").height()-$("#view-footer").height())+"px")};Views.mastersView.startSlide=function(event){var moveSpace=$(this).parent();var fader=$(this).parent().parent().parent();$("#view .fader.is-active").removeClass("is-active");$(fader).addClass("is-active");var mouseCoords=pointerEventToXY(event);var innerY=mouseCoords.y-$(moveSpace).offset().top;var height=$(moveSpace).height();if(innerY<0)innerY=0;if(innerY>height)innerY=height;var level=Math.round((height-innerY)*100/height);if($(this).attr("data-level")!=level){$(this).css("top",(100-level)+"%");$(this).attr("data-level",level);Views.mastersView.faderValueChanged(parseInt($(fader).attr("data-number")),level);$.get("cs/playback/"+(parseInt($(fader).attr("data-number"))+1)+"/level/"+(level/100),function(){})}};Views.mastersView.slide=function(event){if($("#view .fader-list").find(".is-active").length===1){var fader=$("#view .fader-list .is-active");var slider=$(fader).find(".fader-slider");var moveSpace=$(fader).find(".fader-slider-move-space");var mouseCoords=pointerEventToXY(event);var innerY=mouseCoords.y-$(moveSpace).offset().top;var height=$(moveSpace).height();if(innerY<0)innerY=0;if(innerY>height)innerY=height;var level=Math.round((height-innerY)*100/height);if($(slider).attr("data-level")!=level){$(slider).css("top",(100-level)+"%");$(slider).attr("data-level",level);Views.mastersView.faderValueChanged(parseInt($(fader).attr("data-number")),level);$.get("cs/playback/"+(parseInt($(fader).attr("data-number"))+1)+"/level/"+(level/100),function(){})}else if($("#view .fader-list").find(".is-active").length>1){$("#view .fader.is-active").removeClass("is-active")}}};Views.mastersView.stopSlide=function(){$("#view .fader.is-active").removeClass("is-active")};Views.mastersView.pageNum=0;Views.mastersView.playbackLevels=[[]];Views.mastersView.initFaders=function(){var thisView=this;$.getJSON(viewConstants.commandURLs.playbackDATA,function(data){thisView.playbackLevels=new Array(10);for(var i=0;i<10;i++){thisView.playbackLevels[i]=new Array(data.playbacks.length);for(var j=0;j<(data.playbacks.length);j++){thisView.playbackLevels[i][j]=0}}})};Views.mastersView.updateFaders=function(){for(var i=0;i<this.playbackLevels.length;i++){var slider=$("*[data-number='"+i+"']").find(".fader-slider");$(slider).css("top",(100-this.playbackLevels[this.pageNum][i])+"%");$(slider).attr("data-level",this.playbackLevels[this.pageNum][i])}};Views.mastersView.faderValueChanged=function(faderNum,level){this.playbackLevels[this.pageNum][faderNum]=level};Views.playbackView=new View(viewConstants.viewIDs.PLAYBACK_VIEW_ID,viewConstants.commandURLs.playbackDATA,!0);Views.playbackView.insertHTML=function(data){var thisView=this;$.each(data.playbacks,function(i,playback){$("div[data-playback='"+(i+1)+"'] p[class='capsule-val']").html(playback.level);$("#playback-page-num p").html(data.playbackPage);if(playback.contentType.valueOf()==="Seq"){$("div[data-playback='"+(i+1)+"']").removeClass("capsule-memory");$("div[data-playback='"+(i+1)+"']").addClass("capsule-sequence");$("div[data-playback='"+(i+1)+"'] div[class='capsule-low'] button").html("View");$("div[data-playback='"+(i+1)+"'] div[class='capsule-foot'] p").html("t: "+playback.time)}else if(playback.contentType.valueOf()==="Mem"){$("div[data-playback='"+(i+1)+"']").removeClass("capsule-sequence");$("div[data-playback='"+(i+1)+"']").addClass("capsule-memory");$("div[data-playback='"+(i+1)+"'] div[class='capsule-foot'] p").html("t: "+playback.time)}else{$("div[data-playback='"+(i+1)+"']").removeClass("capsule-sequence");$("div[data-playback='"+(i+1)+"']").removeClass("capsule-memory");$("div[data-playback='"+(i+1)+"'] p[class='capsule-val']").html("0");$("div[data-playback='"+(i+1)+"'] div[class='capsule-foot'] p").html("-");$("div[data-playback='"+(i+1)+"'] div[class='capsule-low'] button").html("")}
if(playback.text.valueOf()!=""){$("div[data-playback='"+(i+1)+"'] div[class='capsule-top'] p").html((i+1)+". "+playback.text)}else{$("div[data-playback='"+(i+1)+"'] div[class='capsule-top'] p").html((i+1)+". "+playback.contentType)}
$("div[data-playback='"+(i+1)+"'] div[class='capsule-mid']").html(thisView.getPlaybackContent(playback.contentFlags));if(hasContent(playback.contentFlags)){$("div[data-playback='"+(i+1)+"'] div[class='capsule-mid']").addClass("has-content")}else{$("div[data-playback='"+(i+1)+"'] div[class='capsule-mid has-content']").removeClass("has-content")}
if(thisView.hasLightContent(playback.contentFlags)){$("div[data-playback='"+(i+1)+"'] div[class='capsule-top'] img").attr("src","img/cont1.png")}else{$("div[data-playback='"+(i+1)+"'] div[class='capsule-top'] img").attr("src","img/empty.png")}})};Views.playbackView.generateHTML=function(data){loadDualView();var thisView=this;var generatedHtml="<div class=\"capsule-holder noSelect\">";$.each(data.playbacks,function(i,playback){generatedHtml+="<div class=\"capsule col-xs-1";if(playback.contentType.valueOf()==="Seq"){generatedHtml+=" capsule-sequence"}else if(playback.contentType.valueOf()==="Mem"){generatedHtml+=" capsule-memory"}
generatedHtml+="\" data-playback=\""+(i+1)+"\">";generatedHtml+="<p class=\"capsule-val\">"+playback.level+"</p>";generatedHtml+="<div class=\"capsule-top\" ";if(playback.contentType.valueOf()==="Seq"){generatedHtml+=" "}else if(playback.contentType.valueOf()==="Mem"){generatedHtml+=" "}
generatedHtml+=">";if(thisView.hasLightContent(playback.contentFlags)){generatedHtml+="<img src='img/cont1.png'>"}else{generatedHtml+="<img src='img/empty.png'>"}
generatedHtml+="<p>";if(playback.text.valueOf()===""){if(playback.contentType.valueOf()!=""){generatedHtml+=(i+1)+". "+playback.contentType}}else{generatedHtml+=(i+1)+". "+playback.text}
generatedHtml+="</p></div>";generatedHtml+="<div class='capsule-mid";generatedHtml+=(hasContent(playback.contentFlags))?" has-content'":"'";generatedHtml+=">";generatedHtml+=thisView.getPlaybackContent(playback.contentFlags);generatedHtml+="</div>";generatedHtml+="<div class='capsule-low'>";generatedHtml+="<button data-playback='"+(i+1)+"' class='btn btn-primary'>";if(playback.contentType.valueOf()==="Seq"){generatedHtml+="View"}
generatedHtml+="</button></div>";if(playback.contentType.valueOf()==="Seq"||playback.contentType.valueOf()==="Mem"){generatedHtml+="<div class='capsule-foot'><p>t: "+playback.time+"</p></div>"}else{generatedHtml+="<div class='capsule-foot'><p>-</p></div>"}
generatedHtml+="</div>"});generatedHtml+="</div>"+"<div style='float:left; width:100%; color:rgba(0,0,0,0)'>Stuff</div>";var footerHtml="<div class='capsule-nav-container'><div class='capsule-nav noSelect'><span>Page:</span>"+"<div id='playback-page-plus' class='capsule-nav-cell change-page'><p>+</p></div>"+"<div id='playback-page-num' class='capsule-nav-cell'><p>"+data.playbackPage+"</p></div>"+"<div id='playback-page-minus' class='capsule-nav-cell change-page'><p>-</p></div></div></div>";$(var_view).html(generatedHtml);$("#view-footer").html(footerHtml)};Views.playbackView.hasLightContent=function(hexNum){var content=makeContentArray(hexNum);return content[0]};Views.playbackView.hasPlaybackContent=function(hexNum){var content=makeContentArray(hexNum);for(var i=1;i<content.length;i++){if(content[i]){return!0}}
return!1};Views.playbackView.getPlaybackContent=function(hexNum){var content=makeContentArray(hexNum);var generateIMGS="";for(var i=1;i<content.length;i++){if(content[i]){generateIMGS+="<img src=\"img/cont"+(i+1)+".png\" width=\"24px\" height=\"24px\" />"}else{generateIMGS+="<img src=\"img/empty.png\" width=\"24px\" height=\"24px\" />"}}
return generateIMGS};Views.sequenceView=new View(viewConstants.viewIDs.SEQUENCE_VIEW_ID,viewConstants.commandURLs.seqDATA,!1);Views.sequenceView.rootURL=Views.sequenceView.url;Views.sequenceView.setSequence=function(id){this.url=this.rootURL+id};Views.sequenceView.generateHTML=function(data){$("#sequenceModal .modal-header h4").html("Sequence");var generatedHtml="<h3>Master "+(data.master+1)+"</h3>";if(data.steps.length>0){generatedHtml+="<div class=\"list\"><table><tr class='header'><th></th><th>Step</th><th>Name</th><th>In</th><th>Out</th><th>Wait</th><th>Content</th></tr>";$.each(data.steps,function(i,step){generatedHtml+="<tr>";if(step.flag){generatedHtml+="<td><span class=\"glyphicon glyphicon-flag\" aria-hidden=\"true\"></span></td>"}else{generatedHtml+="<td></td>"}
generatedHtml+="<td>"+(step.cue/10)+"</td>";generatedHtml+="<td>"+step.text+"</td>";generatedHtml+="<td>"+(step.upTime/10)+"</td>";generatedHtml+="<td>"+(step.downTime/10)+"</td>";generatedHtml+="<td>"+(step.waitTime/10)+"</td>";generatedHtml+="<td>"+getContent(step.content.includeFlags)+"</td>";generatedHtml+="</tr>"});generatedHtml+="</table></div>"}else{generatedHtml+="<p>"+data.memoryPage+"</p>";generatedHtml+="<p>"+data.text+"</p>"}
$(var_sequenceModal).html(generatedHtml)};Views.groupView=new View(viewConstants.viewIDs.GROUP_VIEW_ID,viewConstants.commandURLs.groupDATA,!1);Views.groupView.tagURL=Views.groupView.url.tag;Views.groupView.locationURL=Views.groupView.url.location;Views.groupView.generateHTML=function(tagDATA){jQuery.getJSON(this.locationURL,function(locationDATA){loadDualView();var generatedHTML="<div class='level-control noSelect'><div class='top level-head-foot-button'><button id='tag-button' class='btn btn-primary'>Tags</button><button id='location-button' class='btn btn-primary' style='display: none;'>Location</button></div><div id='level-toggle' data-state='bar'><img src='img/arrow-up.png'></div><div class='level-switcher'><div id='level-buttons' class='level-buttons' style='display: none;'><button id='setToFull' class='btn btn-primary'>Full</button><button id='addTen' class='btn btn-primary'>+10</button><button id='addOne' class='btn btn-primary'>+1</button><button id='subOne' class='btn btn-primary'>-1</button><button id='subTen' class='btn btn-primary'>-10</button><button id='setToZero' class='btn btn-primary'>Off</button></div><div id='bar' class='slider-bar noSelect'><div class='slider-background'></div><div id='slider' class='slider' data-moving='false' style='margin: -26px 0px 0px;'><p>Level</p></div></div></div><div class='bottom level-head-foot-button'><button id='clear-button' type='button' class='btn btn-primary' data-trigger='focus' data-html='true' data-toggle='popover' data-placement='left'>Clear</button></div></div>";generatedHTML+="<div class='groups-container'>";generatedHTML+="<div id='location-items' class='groups-content'>";var locCount=0;for(var k=0;k<3;k++){generatedHTML+="<div class='groups-row'>";for(var i=0;i<5;i++){var locItem=locationDATA.locationGroups[locCount];generatedHTML+="<div class='location-groups-cell' data-group-name='"+locItem.text+"' data-group-number='"+locItem.group+"'>"+"<div class='groups-button"+((locItem.content)?" has-content":"")+"'>"+"<img src='img/"+locItem.image+"' /></div></div>";locCount++}
generatedHTML+="</div>"}
generatedHTML+="</div>";generatedHTML+="<div id='tag-items' class='groups-content'>";var tagCount=0;for(var k=0;k<3;k++){generatedHTML+="<div class='groups-row'>";for(var i=0;i<4;i++){var tagItem=tagDATA.tagGroups[tagCount];generatedHTML+="<div class='tag-groups-cell' data-group-number='"+tagItem.group+"'>"+"<div class='groups-button"+((tagItem.content)?" has-content":"")+"'><span>"+tagItem.tag+"</span></div></div>";tagCount++}
generatedHTML+="</div>"}
generatedHTML+="</div>";generatedHTML+="</div>";$(var_view).html(generatedHTML);$('#location-button').hide();$('#tag-items').hide();$('#level-buttons').hide();slider.loadSlider()})};Views.groupView.show=function(){var thisView=this;jQuery.getJSON(this.tagURL,function(data){thisView.generateHTML(data)})};Views.panTiltView=new View(viewConstants.viewIDs.PAN_TILT_VIEW_ID,"",!1);Views.panTiltView.generateHTML=function(data){loadDualView();var generatedHTML="<div class='level-control noSelect'>"+"<div class='top level-head-foot-button'><button id='nudge-button' class='btn btn-primary'>Nudge</button><button id='pan-tilt-picker-button' class='btn btn-primary'>Pick</button></div><div id='level-toggle' data-state='bar'><img src='img/arrow-up.png'></div><div class='level-switcher'><div id='level-buttons' class='level-buttons'><button id='setToFull' class='btn btn-primary'>Full</button><button id='addTen' class='btn btn-primary'>+10</button><button id='addOne' class='btn btn-primary'>+1</button><button id='subOne' class='btn btn-primary'>-1</button><button id='subTen' class='btn btn-primary'>-10</button><button id='setToZero' class='btn btn-primary'>Off</button></div><div id='bar' class='slider-bar noSelect'><div class='slider-background'></div><div id='slider' class='slider' data-moving='false' style='margin: -25px 0px 0px;'><p>Level</p></div></div></div><div class='bottom level-head-foot-button'><button id='clear-button' type='button' class='btn btn-primary' data-trigger='focus' data-html='true' data-toggle='popover' data-placement='left'>Clear</button></div></div>"+"<div class='noSelect pan-tilt-container'><div id='pan-tilt-picker' class='pan-tilt-content'>"+"<div class='pan-tilt-vertical-bar'></div><div class='pan-tilt-horizontal-bar'></div>"+"<form name='pointform' method='post'><img data-touched='false' src='img/empty.png'></form>"+"<div class='message'></div>"+"</div>"+"<div id='pan-tilt-nudge' class='pan-tilt-content'>"+"<div class='pan-tilt-vertical-bar'></div><div class='pan-tilt-horizontal-bar'></div>"+"<div class='pan-tilt-nudge-container'>"+"<div class='pan-buttons'>"+"<button id='panPlus' class='btn btn-primary'>Pan +</button>"+"<button id='panMinus' class='btn btn-primary'>Pan -</button>"+"</div><div class='tilt-buttons'>"+"<button id='tiltPlus' class='btn btn-primary'>Tilt +</button>"+"<button id='tiltMinus' class='btn btn-primary'>Tilt -</button>"+"</div>"+"</div>"+"<div class='message'></div>"+"</div>";$(var_view).html(generatedHTML);$('#pan-tilt-nudge').hide();$('#pan-tilt-picker-button').hide();$('#level-buttons').hide();slider.loadSlider()};Views.panTiltView.show=function(){this.generateHTML(null)};Views.panTiltView.lastPanTilt={"pan":0,"tilt":0};Views.panTiltView.isSameAs=function(panTilt){return(this.lastPanTilt.pan==panTilt.pan&&this.lastPanTilt.tilt==panTilt.tilt)};Views.panTiltView.draging=!1;Views.panTiltView.startSelection=function(event){var element=event.currentTarget
var parentX=parentY=0;while(element){parentX+=(element.offsetLeft-element.scrollLeft+element.clientLeft);parentY+=(element.offsetTop-element.scrollTop+element.clientTop);element=element.offsetParent}
var coords=pointerEventToXY(event);var innerX=coords.x-parentX;var innerY=coords.y-parentY;var width=$(this).width();var height=$(this).height();var pan=Math.round(innerX*100/width);var tilt=Math.round((height-innerY)*100/height);if(!Views.panTiltView.isSameAs({"pan":pan,"tilt":tilt})){Views.panTiltView.draging=!0;Views.panTiltView.lastPanTilt.pan=pan;Views.panTiltView.lastPanTilt.tilt=tilt;jQuery.get("cs/param/panTilt/"+pan+"/"+tilt,function(){})}};Views.panTiltView.moveSelection=function(){if(Views.panTiltView.draging){var element=event.currentTarget
var parentX=parentY=0;while(element){parentX+=(element.offsetLeft-element.scrollLeft+element.clientLeft);parentY+=(element.offsetTop-element.scrollTop+element.clientTop);element=element.offsetParent}
var coords=pointerEventToXY(event);var innerX=coords.x-parentX;var innerY=coords.y-parentY;var width=$(this).width();var height=$(this).height();var pan=Math.round(innerX*100/width);var tilt=Math.round((height-innerY)*100/height);if(pan<0)pan=0;if(tilt<0)tilt=0;if(pan>100)pan=100;if(tilt>100)tilt=100;if(!Views.panTiltView.isSameAs({"pan":pan,"tilt":tilt,isSameAs:null})){Views.panTiltView.lastPanTilt.pan=pan;Views.panTiltView.lastPanTilt.tilt=tilt;jQuery.get("cs/param/panTilt/"+pan+"/"+tilt,function(){})}}};Views.panTiltView.endSelection=function(){Views.panTiltView.draging=!1};Views.cueView=new View(viewConstants.viewIDs.CUE_VIEW_ID,viewConstants.commandURLs.cueDATA,!0);Views.cueView.insertHTML=function(data){$.each(data.steps,function(i,step){$("tr[data-cue='"+step.cue/10+"'] td[class='cue-num']").html((step.cue/10));$("tr[data-cue='"+step.cue/10+"'] td[class='cue-name']").html(step.text);$("tr[data-cue='"+step.cue/10+"'] td[class='cue-up']").html((step.upTime/10));$("tr[data-cue='"+step.cue/10+"'] td[class='cue-down']").html((step.downTime/10));$("tr[data-cue='"+step.cue/10+"'] td[class='cue-wait']").html((step.waitTime/10));$("tr[data-cue='"+step.cue/10+"'] td[class='cue-cont']").html(getContent(step.content.includeFlags))})};Views.cueView.generateHTML=function(data){loadDualView();var activeCue=parseFloat(data.active);var generatedHtml="<div class='cue'>"+"<div class='list'><table><tr class='header'><th></th><th>Cue</th><th>Name</th><th>In</th><th>Out</th><th>Wait</th><th>Content</th></tr>";var thisView=this;$.each(data.steps,function(i,step){generatedHtml+="<tr data-cue='"+(step.cue/10)+"'>";if(step.flag){generatedHtml+="<td><img src=\"img/flag.png\" /></td>"}else{generatedHtml+="<td></td>"}
generatedHtml+="<td class='cue-num'>"+(step.cue/10)+"</td>";generatedHtml+="<td class='cue-name'>"+step.text+"</td>";generatedHtml+="<td class='cue-up'>"+(step.upTime/10)+"</td>";generatedHtml+="<td class='cue-down'>"+(step.downTime/10)+"</td>";generatedHtml+="<td class='cue-wait'>"+(step.waitTime/10)+"</td>";generatedHtml+="<td class='cue-cont'>"+getContent(step.content.includeFlags)+"</td>";generatedHtml+="</tr>"});generatedHtml+="</table></div><div style='float:left; width:100%; color:rgba(0,0,0,0)'>Filer<br />Filler</div><div style='float:left; width:100%; color:rgba(0,0,0,0)'>Filer<br />Filler</div></div>";$(var_view).html(generatedHtml);var footerHtml="<div class='cue-buttons in-line-buttons'><button id='cueBack' class='btn btn-primary' type='submit'><img src='img/cue-back.png' /></button><button id='cuePause' class='btn btn-primary' type='submit'><img src='img/cue-pause.png' /></button><button id='cueGo' class='btn btn-primary' type='submit'><img src='img/cue-go.png' /></button></div>";$("#view-footer").html(footerHtml)};Views.patchView=new View(viewConstants.viewIDs.PATCH_VIEW_ID,viewConstants.commandURLs.patchDATA,!1);Views.patchView.generateHTML=function(data){loadSingletonView();var generatedHtml="<div class=\"list\"><table><tr class='header'><th>Channel</th><th>Make (manufacturer)</th><th>Model</th><th>Mode</th><th>DMX Address</th><th>Universe</th><th>Footprint</th><th>Tag1</th><th>Tag2</th><th>Pan</th><th>Tilt</th><th>Pan/Tilt</th></tr>";$.each(data.devices,function(i,device){var universe=Math.floor(device.dmx/512)+1;var dmxAdd=device.dmx-((universe-1)*512);generatedHtml+="<tr>";generatedHtml+="<td>"+(device.channel+1)+"</td>";generatedHtml+="<td>"+device.manufacturer+"</td>";generatedHtml+="<td>"+device.model+"</td>";generatedHtml+="<td>"+device.mode+"</td>";generatedHtml+="<td>"+dmxAdd+"</td>";generatedHtml+="<td>"+universe+"</td>";generatedHtml+="<td>"+device.footprint+"</td>";generatedHtml+="<td>"+device.tag1+"</td>";generatedHtml+="<td>"+device.tag2+"</td>";if(device.invertPan){generatedHtml+="<td>Inv</td>"}else{generatedHtml+="<td>-</td>"}
if(device.invertTilt){generatedHtml+="<td>Inv</td>"}else{generatedHtml+="<td>-</td>"}
if(device.swapPanTilt){generatedHtml+="<td>Swap</td>"}else{generatedHtml+="<td>-</td>"}
generatedHtml+="</tr>"});generatedHtml+="</table></div>";$(var_view).html(generatedHtml)};Views.dmxuView=new View(viewConstants.viewIDs.DMXU_VIEW_ID,viewConstants.commandURLs.dmxuDATA,!0);Views.dmxuView.rootURL=Views.dmxuView.url;Views.dmxuView.universe="";Views.dmxuView.setUniverse=function(id){this.url=this.rootURL+id;this.universe=id};Views.dmxuView.insertHTML=function(data){$.each(data.outputs,function(i,dmxAddress){$("div[data-address='"+(dmxAddress.output+1)+"'] p[class='dmx-num']").html(dmxAddress.level);$("div[data-address='"+(dmxAddress.output+1)+"'] div[class='dmx-level-bar']").css("height",Math.round(dmxAddress.level/255*100)+"%")})};Views.dmxuView.generateHTML=function(data){thisView=this;jQuery.getJSON(viewConstants.commandURLs.patchDATA,function(patchData){loadSingletonView();var generatedHtml="<nav class='dmxu-page-chooser'>"+"<ul class='pagination'>"+"<li><a href='#dmxu?"+thisView.universe+"?0?128'>1-128</a></li>"+"<li><a href='#dmxu?"+thisView.universe+"?128?256'>129-256</a></li>"+"<li><a href='#dmxu?"+thisView.universe+"?256?384'>257-384</a></li>"+"<li><a href='#dmxu?"+thisView.universe+"?384?512'>385-512</a></li>"+"</ul>"+"</nav>"+"<div class='dmxu-holder'>";var url=window.location.href;var variables=url.split('?');startIndex=0;endIndex=128;if(variables.length===4){startIndex=parseInt(variables[2]);endIndex=parseInt(variables[3])}
var indexSpacer=(thisView.universe-1)*512;for(var i=startIndex;i<endIndex;i++){var dmxAttrib=patchData.outputs[i+indexSpacer];var dmxAddress=data.outputs[i];generatedHtml+="<div class='dmxu-cell";if(dmxAttrib.overlap){generatedHtml+=" overlap"}
if(dmxAttrib.status.valueOf()==="unpatched"){generatedHtml+=" unpatched"}else if(dmxAttrib.status.valueOf()=="deviceStart"){generatedHtml+=" device-start"}else if(dmxAttrib.status.valueOf()=="dimmer"){generatedHtml+=" dimmer"}else{generatedHtml+=" device-content"}
generatedHtml+="' data-address='"+(dmxAddress.output+1)+"'>";generatedHtml+="<div class='dmx-level-container'>";generatedHtml+="<div class='dmx-level-bar' style='height:"+Math.round(dmxAddress.level/255*100)+"%'></div>";generatedHtml+="</div>";generatedHtml+="<p class='addr-num'>"+(dmxAddress.output+1)+"</p>";generatedHtml+="<p class='dmx-num'>"+(((dmxAttrib.status.valueOf()!=="unpatched"))?dmxAddress.level:"0")+"</p>";generatedHtml+="<p class='dmx-text'>"+dmxAttrib.text+"</p>";generatedHtml+="</div>"}
generatedHtml+="</div>";$(var_view).html(generatedHtml)})};Views.helpView=new View(viewConstants.viewIDs.HELP_VIEW_ID,viewConstants.commandURLs.helpDATA,!0);Views.helpView.rootUrl="/help/";Views.helpView.urlTarget="current";Views.helpView.variables="?ifChanged=true";Views.helpView.insertHTML=function(data){if(data.valueOf()!=""){var page=this.cleanLinks($.parseHTML(data));if(page.length>0){$("#help").html("");$("#help").append(page)}}};Views.helpView.generateHTML=function(data){loadSingletonView();$(var_view).html("<div id='help'></div>");if(data.valueOf()!=""){var page=this.cleanLinks($.parseHTML(data));$("#help").html("");$("#help").append(page)}else{$("#help").html("")}};Views.helpView.cleanLinks=function(page){$.each(page,function(i,element){if($(element).attr("href")!=undefined){if($(element).is("a")){var href=$(element).attr("href");$(element).attr("href","#help?"+href)}else{var href=$(element).attr("href");$(element).attr("href","/help/"+href)}}
else if($(element).attr("src")!=undefined){var href=$(element).attr("src");$(element).attr("src","/help/"+href)}});var imgItems=$(page).find("img");$.each(imgItems,function(i,item){var href=$(item).attr("src");$(item).attr("src","/help/"+href)});var anchorItems=$(page).find("a");$.each(anchorItems,function(i,item){var href=$(item).attr("href");$(item).attr("href","#help?"+href)});return page};Views.helpView.show=function(){var thisView=this;jQuery.get(this.rootUrl+this.urlTarget,function(data){thisView.generateHTML(data);if(thisView.refreshEnabled){thisView.poll()}else{thisView.draw()}})};Views.helpView.poll=function(){var thisView=this;this.timeout=setTimeout(function(){if(ViewManager.isViewActive(thisView)){jQuery.get(thisView.url+thisView.variables,function(data){thisView.insertHTML(data);thisView.poll()})}},this.REFRESH_TIME)}}