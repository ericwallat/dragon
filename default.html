<!doctype html>
<!--[if lt IE 7]>      <html class="no-js lt-ie9 lt-ie8 lt-ie7" lang=""> <![endif]-->
<!--[if IE 7]>         <html class="no-js lt-ie9 lt-ie8" lang=""> <![endif]-->
<!--[if IE 8]>         <html class="no-js lt-ie9" lang=""> <![endif]-->
<!--[if gt IE 8]><!-->
<html class="no-js" lang="">
<!--<![endif]-->
<head>
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
<title>Dragon</title>
<meta name="description" content="">
<meta name="viewport" content="width=device-width, initial-scale=1">

<link rel="stylesheet" href="css/bootstrap.min.css">
<!--        <link rel="stylesheet" href="assets/css/bootstrap-theme.min.css">-->


<!--For Plugins external css-->
<link rel="stylesheet" href="css/channels.css">
<link rel="stylesheet" href="css/level-color.css">

<!--Theme custom css -->
<link rel="stylesheet" href="css/style.css">

<!--Theme Responsive css-->
<link rel="stylesheet" href="css/responsive.css" />

</head>
<body>
	<!--[if lt IE 8]>
            <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="http://browsehappy.com/">upgrade your browser</a> to improve your experience.</p>
        <![endif]-->


	<!--Home page style-->

	<div class="separator"></div>
	<header class="home home-main-bar">
		<div id="home" class="home home-main-content">
			<div class="headerlogo">
				<a href='#'><img id="etclogo" src="images/etclogo.png"></a>
			</div>
			<div class="div-menu">
				<a href="#about"><span style="font-size: 1rem; color: white;">Change
						the Dragon's Lights!</span></a>
			</div>
			<div class="div-menu">
				<a href="http://etcconnect.com"><span
					style="font-size: 1rem; color: white;">Visit etcconnect.com</span></a>
			</div>
		</div>
	</header>


	<div class="container" id="main-body">
		<div class="alert" id="info">
			<span class="closebtn"
				onclick="this.parentElement.style.display='none';">Ã—</span> <strong>Hi!</strong>
			Change the dragon's lights by clicking on the lights below or by
			selecting a preset show!
		</div>
		<div class="split">
			<div class="container" id="main-body-grid">
				<div id="channels" class="grid"
					style="padding-left: 0%; z-index: 3; margin: auto;">
					<div class="grid-row" style="height: 12.5%;">
						<div class="grid-cell noSelect notSelected" data-type="chan-color"
							data-channel="1" style="width: 33%;">
							<button
								class="jscolor {closable:true,closeText:'Close',valueElement: 'color_value', onFineChange:'update(this)'}"
								style="width: 100%; height: 100%;"
								style="width:100%;height:100%;">1</button>
						</div>
						<div class="grid-cell noSelect notSelected" data-type="chan-color"
							data-channel="2" style="width: 33%;">
							<button
								class="jscolor {closable:true,closeText:'Close',valueElement: 'color_value', onFineChange:'update(this)'}"
								style="width: 100%; height: 100%;">2</button>
						</div>
						<div class="grid-cell noSelect notSelected" data-type="chan-color"
							data-channel="3" style="width: 33%;">
							<button
								class="jscolor {closable:true,closeText:'Close',valueElement: 'color_value', onFineChange:'update(this)'}"
								style="width: 100%; height: 100%;">3</button>
						</div>
					</div>
					<div class="grid-row" style="height: 12.5%;">
						<div class="grid-cell noSelect notSelected" data-type="chan-color"
							data-channel="4" style="width: 33%;">
							<button
								class="jscolor {closable:true,closeText:'Close',valueElement: 'color_value', onFineChange:'update(this)'}"
								style="width: 100%; height: 100%;"
								style="width:100%;height:100%;">4</button>
						</div>
						<div class="grid-cell noSelect notSelected" data-type="chan-color"
							data-channel="5" style="width: 33%;">
							<button
								class="jscolor {closable:true,closeText:'Close',valueElement: 'color_value', onFineChange:'update(this)'}"
								style="width: 100%; height: 100%;">5</button>
						</div>
						<div class="grid-cell noSelect notSelected" data-type="chan-color"
							data-channel="6" style="width: 33%;">
							<button
								class="jscolor {closable:true,closeText:'Close',valueElement: 'color_value', onFineChange:'update(this)'}"
								style="width: 100%; height: 100%;">6</button>
						</div>
					</div>
					<div class="grid-row" style="height: 12.5%;">
						<div class="grid-cell noSelect notSelected" data-type="chan-color"
							data-channel="7" style="width: 33%;">
							<button
								class="jscolor {closable:true,closeText:'Close',valueElement: 'color_value', onFineChange:'update(this)'}"
								style="width: 100%; height: 100%;"
								style="width:100%;height:100%;">7</button>
						</div>
						<div class="grid-cell noSelect notSelected" data-type="chan-color"
							data-channel="8" style="width: 33%;">
							<button
								class="jscolor {closable:true,closeText:'Close',valueElement: 'color_value', onFineChange:'update(this)'}"
								style="width: 100%; height: 100%;">8</button>
						</div>
						<div class="grid-cell noSelect notSelected" data-type="chan-color"
							data-channel="9" style="width: 33%;">
							<button
								class="jscolor {closable:true,closeText:'Close',valueElement: 'color_value', onFineChange:'update(this)'}"
								style="width: 100%; height: 100%;">9</button>
						</div>
					</div>
					<div class="grid-row" style="height: 12.5%;">
						<div class="grid-cell noSelect notSelected" data-type="chan-color"
							data-channel="10" style="width: 33%;">
							<button
								class="jscolor {closable:true,closeText:'Close',valueElement: 'color_value', onFineChange:'update(this)'}"
								style="width: 100%; height: 100%;"
								style="width:100%;height:100%;">10</button>
						</div>
						<div class="grid-cell noSelect notSelected" data-type="chan-color"
							data-channel="11" style="width: 33%;">
							<button
								class="jscolor {closable:true,closeText:'Close',valueElement: 'color_value', onFineChange:'update(this)'}"
								style="width: 100%; height: 100%;">11</button>
						</div>
						<div class="grid-cell noSelect notSelected" data-type="chan-color"
							data-channel="12" style="width: 33%;">
							<button
								class="jscolor {closable:true,closeText:'Close',valueElement: 'color_value', onFineChange:'update(this)'}"
								style="width: 100%; height: 100%;">12</button>
						</div>
					</div>
					<div class="grid-row" style="height: 12.5%;">
						<div class="grid-cell noSelect notSelected" data-type="chan-color"
							data-channel="13" style="width: 33%;">
							<button
								class="jscolor {closable:true,closeText:'Close',valueElement: 'color_value', onFineChange:'update(this)'}"
								style="width: 100%; height: 100%;"
								style="width:100%;height:100%;">13</button>
						</div>
					</div>
				</div>
			</div>




			<div class="videocontainer">

				<object width="640" height="360">
					<param name="movie"
						value="http://www.youtube.com/embed/8CEPifkhPGA?showinfo=0&amp;autoplay=1&amp;html5=1&amp;rel=0&amp;hl=en_US&amp;version=3" />
					<param name="allowFullScreen" value="true" />
					<param name="allowscriptaccess" value="always" />
					<embed id="video" width="640" height="360"
						src="http://www.youtube.com/embed/8CEPifkhPGA?showinfo=0&amp;autoplay=1&amp;html5=1&amp;rel=0&amp;hl=en_US&amp;version=3"
						class="youtube-player" type="text/html" allowscriptaccess="always"
						allowfullscreen="true" style="width: 100%;" />
				</object>


			</div>
			<div class="container" id="main-body-grid">
					<select class="selectpicker" data-style="btn-info"
						style="display: none;">
						<option>Mustard</option>
						<option>Ketchup</option>
						<option>Relish</option>
					</select>
			</div>

		</div>
	</div>


	<script src="js/vendor/jquery-1.11.2.min.js"></script>
	<script src="js/vendor/bootstrap.min.js"></script>

	<script src="js/jscolor.js"></script>
	<script src="js/ColorSource.js"></script>
	<script src="js/Events.js"></script>
	<script src="js/PageManager.js"></script>
	<script src="js/Slider.js"></script>
	<script src="js/Views.js"></script>
	<script src="js/debounce.js"></script>

	<script type="text/javascript">
		var lastClick = 0;
		var h = 0;
		var s = 0;
		var v = 0;
		var delay = 100;
		var loaded = 0;
		var playing = true;
		var ojon = $.getJSON("py/data.json", function(json) {
			ojson = json;
		});

		var el = document.createElement('script');
		el.src = 'py/data.json?nocache=' + (new Date()).getTime();
		document.head.appendChild(el);

		getColors();
		setInterval(getColors, 2000)

		function postData(arr) {
			$.ajax({
				type : "POST",
				url : "http://EWALLAT7-32987:5000",
				data : JSON.stringify(arr),
				dataType : "json",
				contentType : 'application/json; charset=utf-8',
				success : function(data) {
					console.log(data);
				}
			});
		}

		function callbackFunc(response) {
			// do something with the response
			console.log(response);
		}

		function update(jscolor) {
			h = Math.round(jscolor.hsv[0]);
			s = Math.round(jscolor.hsv[1]);
			v = Math.round(jscolor.hsv[2]);
			if (lastClick >= Date.now() - delay) {
				return;
			}
			lastClick = Date.now();
			var arr = {
				'chan' : jscolor.styleElement.textContent,
				'hue' : h,
				'sat' : s,
				'val' : v,
				'play' : false
			};
			postData(arr);
			playing = false;
		}

		function getColors() {
			$
					.getJSON(
							"py/data.json",
							function(json) {
								if ((JSON.stringify(ojson) != JSON
										.stringify(json))
										|| loaded == 0) {
									for (var i = 0; i < Object.keys(json).length; i++) {
										var jsoni = parseInt($(".noSelect")[i].children[0].textContent);
										$(".noSelect")[i].children[0].style.backgroundColor = json[jsoni];
										$(".noSelect")[i].children[0].style.color = isLight(json[jsoni]) ? '#000'
												: '#FFF';
									}
									loaded = 1;
								}
							});
			if (lastClick <= Date.now() - 60000 && !playing) {
				$.ajax({
					type : "POST",
					url : "http://EWALLAT7-32987:5000",
					data : JSON.stringify({
						'play' : true
					}),
					dataType : "json",
					contentType : 'application/json; charset=utf-8',
					success : function(data) {
						console.log(data);
					}
				});
				console.log("play");
				playing = true;
			}
		}

		function isLight(rgb) {
			rgb = rgb.replace(/[^\d,.]/g, '').split(',');
			return (0.213 * rgb[0] + 0.715 * rgb[1] + 0.072 * rgb[2] > 255 / 2);
		}

		function resize() {
			var grids = $(".grid-row").length;
			for (var i = 0; i < grids; i++) {
				$(".grid-row").eq(i).height($(".noSelect").eq(0).width());
			}
			var width = $(".split").width() * 0.61;
			var height = width / 1.77777;
			$("#video").attr("width", width);
			$("#video").attr("height", height);

		}

		window.onresize = resize;

		$(document).ready(function() {
			resize();
			console.log("yes");
		});
	</script>
</body>
</html>
